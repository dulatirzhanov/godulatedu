<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Redirecting…</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root { color-scheme: light dark }

    /* базовая структура */
    body {
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      background: #fff;
      color: #333;
    }

    /* карточка */
    .card {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 12px 40px rgba(0,0,0,.25);
      padding: 24px 20px;
      max-width: 420px;
      width: calc(100vw - 40px);
      text-align: center;
    }

    /* заголовок и текст меньшего размера */
    h1 {
      margin: 0 0 6px;
      font-size: 1rem;
      font-weight: bold;
    }

    p {
      margin: 0 0 14px;
      color: #666;
      font-size: 0.9rem;
      line-height: 1.4;
    }

    /* кнопка в стиле твоего сайта */
    .cta-post {
      display: inline-block;
      padding: 10px 16px;
      border-radius: 12px;
      font-weight: bold;
      text-decoration: none;
      font-size: 0.9rem;
      background: rgba(10,102,194,0.06);
      color: #0a66c2;
      border: 1px solid rgba(10,102,194,0.25);
      transition: background .15s ease, border-color .15s ease;
    }

    .cta-post:hover {
      background: rgba(10,102,194,0.1);
      border-color: rgba(10,102,194,0.35);
    }

    /* тёмная тема */
    @media (prefers-color-scheme: dark) {
      body { background: #111; color: #ddd; }
      p { color: #bbb; }
      .card {
        background: #1a1a1a;
        box-shadow: 0 12px 40px rgba(0,0,0,.6);
      }
      .cta-post {
        background: rgba(207,224,255,0.06);
        color: #cfe0ff;
        border: 1px solid rgba(207,224,255,0.22);
      }
      .cta-post:hover {
        background: rgba(207,224,255,0.12);
        border-color: rgba(207,224,255,0.32);
      }
    }
  </style>
</head>
<body>
  <div class="card">
    <h1 id="status">Checking short link…</h1>
    <p id="message"></p>
    <a id="homeBtn" class="cta-post" href="/" style="display:none" rel="noopener">Go to Home</a>
  </div>

  <script>
    (function () {
      const statusEl = document.getElementById('status');
      const messageEl = document.getElementById('message');
      const homeBtn = document.getElementById('homeBtn');
      const slug = window.location.pathname.replace(/^\/+/, '').replace(/\/+$/, '');

      if (!slug) {
        statusEl.textContent = 'Unknown short code.';
        messageEl.textContent = 'No short code was provided.';
        homeBtn.style.display = 'inline-block';
        return;
      }

      fetch('/data/mapping.json', { cache: 'no-store' })
        .then(r => {
          if (!r.ok) throw new Error('Unable to load mapping.');
          return r.json();
        })
        .then(mapping => {
          if (mapping && mapping[slug] && mapping[slug].final_url) {
            statusEl.textContent = 'Redirecting…';
            messageEl.textContent = 'Sending you to your destination.';
            window.location.replace(mapping[slug].final_url);
          } else {
            statusEl.textContent = 'Unknown short code.';
            messageEl.textContent = 'We could not find a destination for "' + slug + '".';
            homeBtn.style.display = 'inline-block';
          }
        })
        .catch(err => {
          statusEl.textContent = 'Redirect failed.';
          messageEl.textContent = err.message;
          homeBtn.style.display = 'inline-block';
        });
    })();
  </script>
</body>
</html>
