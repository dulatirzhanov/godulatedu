<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Redirecting...</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      color-scheme: dark;
      --bg: #0f172a;
      --panel: rgba(255, 255, 255, 0.06);
      --text: #e2e8f0;
      --muted: #94a3b8;
      --accent: rgba(59, 130, 246, 0.25);
      --accent-hover: rgba(59, 130, 246, 0.4);
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
      background: var(--bg);
      color: var(--text);
    }

    .card {
      background: var(--panel);
      padding: 2rem 2.5rem;
      border-radius: 12px;
      box-shadow: 0 0 40px rgba(0,0,0,0.25);
      text-align: center;
      max-width: 420px;
      backdrop-filter: blur(8px);
    }

    h1 {
      margin-top: 0;
      font-size: 1.4rem;
      font-weight: 600;
    }

    p {
      margin: 0.75rem 0 1.5rem;
      line-height: 1.6;
      color: var(--muted);
    }

    a.btn {
      display: inline-block;
      text-decoration: none;
      padding: 0.75rem 1.5rem;
      border-radius: 6px;
      border: 1px solid var(--accent);
      color: var(--text);
      background: var(--accent);
      transition: background 0.2s, border 0.2s;
    }

    a.btn:hover {
      background: var(--accent-hover);
      border-color: var(--accent-hover);
    }

    .fade {
      opacity: 0;
      transform: translateY(8px);
      animation: fadeIn 0.6s ease forwards;
    }

    @keyframes fadeIn {
      to {
        opacity: 1;
        transform: none;
      }
    }
  </style>
</head>
<body>
  <div class="card fade">
    <h1 id="status">Checking short link…</h1>
    <p id="message"></p>
    <a id="homeBtn" class="btn" href="/" style="display:none;">Go to Home</a>
  </div>

  <script>
    (function() {
      const statusEl = document.getElementById('status');
      const messageEl = document.getElementById('message');
      const homeBtn = document.getElementById('homeBtn');
      const slug = window.location.pathname.replace(/^\/+/, '').replace(/\/+$/, '');

      if (!slug) {
        statusEl.textContent = 'Unknown short code.';
        messageEl.textContent = 'No short code was provided.';
        homeBtn.style.display = 'inline-block';
        return;
      }

      fetch('/data/mapping.json', { cache: 'no-store' })
        .then(r => {
          if (!r.ok) throw new Error('Unable to load mapping.');
          return r.json();
        })
        .then(mapping => {
          if (mapping && mapping[slug] && mapping[slug].final_url) {
            statusEl.textContent = 'Redirecting…';
            messageEl.textContent = 'Sending you to your destination.';
            window.location.replace(mapping[slug].final_url);
          } else {
            statusEl.textContent = 'Unknown short code.';
            messageEl.textContent = 'We could not find a destination for "' + slug + '".';
            homeBtn.style.display = 'inline-block';
          }
        })
        .catch(err => {
          statusEl.textContent = 'Redirect failed:';
          messageEl.textContent = err.message;
          homeBtn.style.display = 'inline-block';
        });
    })();
  </script>
</body>
</html>
